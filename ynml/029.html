<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   <HEAD>
      <TITLE>My first HTML document</TITLE>
      <style rel="stylesheet" type="text/css">
body {
 font-size: 25px;
 
 margin-top: 50px;
    margin-bottom: 50px;
    margin-right: 80px;
    margin-left: 80px;
    
    padding-top: 50px;
    padding-bottom: 50px;
    padding-right: 80px;
    padding-left: 80px;
    
    line-height:1.6em
}
</style>
      <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    "HTML-CSS" : {
        availableFonts : ["STIX"],
        preferredFont : "STIX",
        webFont : "STIX-Web",
        imageFont : null
    }
});
</script>
     <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js" type="text/javascript">    
    MathJax.Hub.Config({
        HTML: ["input/TeX","output/HTML-CSS"],
        TeX: { extensions: ["AMSmath.js","AMSsymbols.js"], 
               equationNumbers: { autoNumber: "AMS" } },
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                   displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                   processEscapes: true },
        "HTML-CSS": { availableFonts: ["TeX"],
                      linebreaks: { automatic: true } }
    });
</script>
   </HEAD>
   <BODY>
029. Classifying text data into class by MLP(multi layer perceptron), Converting text data into vector<br/>
<xmp>
@
from keras.models import Sequential
from keras.layers import Dense, Dropout, Activation
from keras.wrappers.scikit_learn import KerasClassifier
from keras.utils import np_utils
from sklearn.model_selection import train_test_split
from sklearn import model_selection, metrics
import json

# The number of words in text is 56681
# You can check it out in word-dic.json file
max_words = 56681
# There are 6 categories(like genres)
nb_classes = 6    
batch_size = 64 
nb_epoch = 20

# This is a method which creates MLP(multi layer perceptron) model,
# which will be passed into KerasClassfier as argument
def build_model():
    model = Sequential()
    model.add(Dense(512, input_shape=(max_words,)))
    model.add(Activation('relu'))
    model.add(Dropout(0.5))
    model.add(Dense(nb_classes))
    model.add(Activation('softmax'))
    model.compile(loss='categorical_crossentropy',
        optimizer='adam',
        metrics=['accuracy'])
    return model

# I load mini size data file
data = json.load(open("./newstext/data-mini.json")) 
# I load full size data file
#data = json.load(open("./newstext/data.json"))
X = data["X"] # 텍스트를 나타내는 데이터
Y = data["Y"] # 카테고리 데이터

# 학습하기 --- (※3)
X_train, X_test, Y_train, Y_test = train_test_split(X, Y)
Y_train = np_utils.to_categorical(Y_train, nb_classes)
print(len(X_train),len(Y_train))

# I create classifier
model = KerasClassifier(
    build_fn=build_model, 
    nb_epoch=nb_epoch, 
    batch_size=batch_size)

# I make "created classifier" to learn
# by passing feature and label of train data
# X_train is frequency of appearance of word like data = [2,2,2,1,1,1,1]
# Y_train is categories(some like genre)
model.fit(X_train, Y_train)

# For predicting
y = model.predict(X_test)

# For evaluating
ac_score = metrics.accuracy_score(Y_test, y)
cl_report = metrics.classification_report(Y_test, y)
print("accuracy: ", ac_score)
print("report: \n", cl_report)


@
# Let's talk about the method how you convert text data into fixed length vector
# Suppose we have following sentence "몇 번을 쓰러지더라도 몇 번을 무너지더라도 다시 일어나라"
# We process morphological analysis by Twitter morphological analyzer
# and we get following processed output
# 몇|번|을|쓰러지다|몇|번|을|무너지다|다시|일어나다

# To convert text data into vector, we need "word_dictionary" and "data"

# If we can't find "몇" in word_dictionary, we input "몇" into word_dictionary
# with unique ID number representing "몇"
# If we can find "몇" in word_dictionary, we just pass without doing anything

# word_dictionary = 
# {
#     "몇":1,
#     "번":2,
#     "을":3,
#     "쓰러지다":4,
#     "무너지다":5,
#     "다시":6,
#     "일어나다":7
# }

# You can make this word dictionary for entire text, resulting a lot of elements in vector

# Now, we can make vector of above sentence by counting frequency of appearance in text
# data = [2,2,2,1,1,1,1]

</xmp>
   </BODY>
</HTML>
